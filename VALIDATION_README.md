# Валидация форм в проекте VoltUp

## Обзор

В проекте реализована комплексная система валидации форм с использованием React и Redux. Валидация обеспечивает проверку корректности введенных данных перед отправкой на сервер.

## Компоненты с валидацией

### 1. ApplicationForm (Форма подачи заявок)

**Файл:** `src/components/ApplicationForm.jsx`

**Поля с валидацией:**

- **Наименование контрагента** (для юр. лиц): минимум 2 символа
- **ИНН**: ровно 10 цифр
- **КПП**: ровно 9 цифр
- **ЕГРЮЛ**: ровно 13 цифр
- **Дата внесения в реестр**: обязательное поле
- **Юридический адрес**: минимум 10 символов
- **Фактический адрес**: минимум 10 символов
- **Почтовый адрес**: минимум 10 символов
- **Телефон**: корректный формат номера
- **Причина обращения**: минимум 5 символов
- **Объект**: минимум 3 символа
- **Адрес объекта**: минимум 10 символов
- **ОКВЭД** (для юр. лиц): формат XX.XX
- **Мощность**: положительное число
- **Напряжение**: положительное число
- **Сбытовая компания**: минимум 2 символа
- **Категория надежности**: значение 1, 2 или 3

### 2. FeedbackForm (Форма обратной связи)

**Файл:** `src/components/FeedbackForm.jsx`

**Поля с валидацией:**

- **Оценка**: обязательный выбор (1-5)
- **Комментарий**: минимум 10 символов

### 3. Login (Форма входа)

**Файл:** `src/components/Login.jsx`

**Поля с валидацией:**

- **Имя пользователя**: минимум 3 символа
- **Пароль**: минимум 4 символа

## Утилиты валидации

### Файл: `src/utils/validation.js`

Содержит переиспользуемые функции валидации:

#### Основные функции:

- `validateINN(inn)` - валидация ИНН
- `validateKPP(kpp)` - валидация КПП
- `validateEGRUL(egrul)` - валидация ЕГРЮЛ
- `validatePhone(phone)` - валидация телефона
- `validateEmail(email)` - валидация email
- `validateAddress(address, fieldName)` - валидация адреса
- `validateText(text, fieldName, minLength)` - валидация текста
- `validateNumber(number, fieldName, minValue)` - валидация числа
- `validateDate(date, fieldName)` - валидация даты
- `validateOKVED(okved)` - валидация ОКВЭД
- `validateReliabilityCategory(category)` - валидация категории надежности
- `validateRating(rating)` - валидация рейтинга
- `validateComment(comment, minLength)` - валидация комментария
- `validateUsername(username)` - валидация имени пользователя
- `validatePassword(password, minLength)` - валидация пароля

#### Хук для управления валидацией:

```javascript
const {
  formData,
  errors,
  touched,
  handleChange,
  handleBlur,
  validateForm,
  resetForm,
  setFormData,
} = useFormValidation(initialData, validationRules);
```

## Стили для ошибок

### Общие стили ошибок:

- **Цвет ошибки**: `#dc3545` (красный)
- **Анимация**: плавное появление снизу
- **Фон**: полупрозрачный красный
- **Граница**: красная слева

### Файлы стилей:

- `src/styles/application.scss` - стили для ApplicationForm
- `src/styles/feedback.scss` - стили для FeedbackForm
- `src/styles/auth.scss` - стили для Login

## Принципы работы валидации

### 1. Валидация в реальном времени

- Ошибки показываются после потери фокуса (onBlur)
- При изменении поля ошибка обновляется, если поле уже "тронуто"

### 2. Валидация при отправке

- Все поля помечаются как "тронутые"
- Показываются все ошибки
- Форма не отправляется при наличии ошибок

### 3. Условная валидация

- Некоторые поля валидируются только для определенных типов пользователей
- Поля юр. лиц не валидируются для физ. лиц

### 4. Очистка ошибок

- При смене типа пользователя очищаются ошибки неактуальных полей
- При успешной отправке формы все ошибки сбрасываются

## Пример использования

```javascript
import {
  validateINN,
  validatePhone,
  validateAddress,
} from "../utils/validation";

const validationRules = {
  inn: validateINN,
  phone: validatePhone,
  address: (value) => validateAddress(value, "Юридический адрес"),
};

const handleSubmit = (e) => {
  e.preventDefault();

  // Помечаем все поля как "тронутые"
  setTouched({ inn: true, phone: true, address: true });

  // Валидация формы
  if (!validateForm()) {
    alert("Пожалуйста, исправьте ошибки в форме");
    return;
  }

  // Отправка формы
  submitForm();
};
```

## Добавление новой валидации

### 1. Создать функцию валидации в `validation.js`:

```javascript
export const validateNewField = (value) => {
  if (!value) return "Поле обязательно";
  if (value.length < 5) return "Минимум 5 символов";
  return "";
};
```

### 2. Добавить валидацию в компонент:

```javascript
const validateField = (name, value) => {
  switch (name) {
    case "newField":
      return validateNewField(value);
    // ... другие поля
  }
  return "";
};
```

### 3. Добавить стили ошибок в SCSS файл:

```scss
.form-input {
  &.error {
    border-color: #dc3545;
    box-shadow: 0 0 5px rgba(#dc3545, 0.3);
  }
}

.error-message {
  color: #dc3545;
  font-size: 0.875rem;
  margin: 0.25rem 0 0 0;
  padding: 0.25rem 0.5rem;
  background: rgba(#dc3545, 0.1);
  border-radius: 4px;
  border-left: 3px solid #dc3545;
  animation: slideIn 0.3s ease;
}
```

## Тестирование валидации

Для тестирования валидации рекомендуется:

1. **Проверить обязательные поля** - оставить пустыми и попытаться отправить
2. **Проверить минимальную длину** - ввести короткие значения
3. **Проверить форматы** - ввести некорректные форматы (ИНН, телефон, email)
4. **Проверить условную валидацию** - сменить тип пользователя
5. **Проверить очистку ошибок** - исправить ошибки и убедиться, что они исчезли

## Заключение

Система валидации обеспечивает:

- ✅ Корректность данных перед отправкой
- ✅ Удобный UX с подсказками об ошибках
- ✅ Переиспользуемость кода
- ✅ Легкость расширения и поддержки
- ✅ Адаптивность под разные типы пользователей
